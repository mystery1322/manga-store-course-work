<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Товар — Лавка Мечтаний</title>
  <link rel="icon" href="images/fav.png">
  <link href="style.css" rel="stylesheet">
  <link href="cart.css" rel="stylesheet">
</head>
<body class="page-product">
  <!-- Шапка: можно вставить общий header -->
  <header class="site-header">
    <div class="logo-block">
      <a href="index.html" class="logo-link"><img src="images/logo.png" alt="Логотип" width="79"><span class="site-title">Лавка Мечтаний</span></a>
    </div>
    <nav class="main-nav"> ... </nav>
  </header>

  <main style="padding:110px 20px 40px;">
    <div id="product-root" style="max-width:1100px;margin:0 auto;"></div>
  </main>

    <footer class="site-footer"> ... </footer>

    <script src="scripts/products-data.js" defer></script> <!-- ДАННЫЕ -->
    <script src="scripts/scripts.js" defer></script>       <!-- общие функции (опционально) -->
    <script src="scripts/product.js" defer></script>       <!-- этот файл -->

  <!-- логика страницы товара -->
  <script>
  // product.js inline — читает id, рендерит
  (function(){
    function getProductIdFromUrl() {
      const params = new URLSearchParams(location.search);
      return params.get('id');
    }

    function formatPrice(p) { return Number(p).toFixed(2) + ' ₽'; }

    const root = document.getElementById('product-root');
    const id = getProductIdFromUrl();
    if(!id) {
      root.innerHTML = '<div class="cart-empty"><h3>Товар не указан</h3><p>Проверьте ссылку.</p></div>';
      return;
    }

    // PRODUCTS доступен как window.PRODUCTS (из products-data.js)
    const prodList = window.PRODUCTS || [];
    const item = prodList.find(p => p.id === id);

    if(!item) {
      root.innerHTML = '<div class="cart-empty"><h3>Товар не найден</h3><p>Возможно, он был удалён.</p></div>';
      return;
    }

    // render
    root.innerHTML = `
      <article class="product-detail" style="display:grid;grid-template-columns:360px 1fr;gap:24px;align-items:start;border:1px solid #eee;padding:18px;border-radius:12px;background:#fff;">
        <div>
          <img src="${item.img}" alt="${item.title}" style="width:100%;height:auto;object-fit:cover;border-radius:8px;max-height:640px;">
        </div>
        <div>
          <h1 style="margin-top:0;color:#2a1365">${item.title}</h1>
          <p style="margin:4px 0 10px;color:#666">Автор: ${item.author || '—'}</p>
          <p style="margin:6px 0 12px;color:#444"><strong>Жанры:</strong> ${Array.isArray(item.genre) ? item.genre.join(', ') : (item.genre||'—')}</p>
          <p style="margin:8px 0 20px;color:#333">${item.desc || 'Описание отсутствует.'}</p>

          <div style="display:flex;gap:12px;align-items:center;">
            <div style="font-size:1.4rem;font-weight:800;color:#0a7a0a">${formatPrice(item.price)}</div>
            <div>
              <button id="addToCartBtn" class="btn">Добавить в корзину</button>
            </div>
          </div>

          <div style="margin-top:14px;color:#666;font-size:0.95rem;">
            <p>Детали: состояние — новое. Доставка: 3-7 дней.</p>
          </div>
        </div>
      </article>
    `;

    // Поведение кнопки — используем глобальный addToCart если есть, иначе фолбек:
    document.getElementById('addToCartBtn').addEventListener('click', function(){
      // сначала пробуем глобальную функцию addToCart (как в catalog.js)
      if(typeof window.addToCart === 'function') {
        window.addToCart(item.id, 1);
      } else {
        // простой fallback: сохраняем в localStorage так же как cart использует
        const KEY = 'manga_cart_v1';
        const cart = JSON.parse(localStorage.getItem(KEY) || '[]');
        const existing = cart.find(x=>x.id===item.id);
        if(existing) existing.qty = (existing.qty||0) + 1;
        else cart.push({ id: item.id, title: item.title, price: item.price, img: item.img, author: item.author, qty: 1 });
        localStorage.setItem(KEY, JSON.stringify(cart));
        if(window.updateCartBadge) window.updateCartBadge();
      }
      // красивое уведомление
      if(window.showToast) showToast(item.title + ' добавлен в корзину', 'success', 2200);
      else alert(item.title + ' добавлен в корзину');
    });

  })();
  </script>
</body>
</html>
